version: '3.8'

services:
  proctoring:
    build: .
    container_name: proctoring-ml-service
    environment:
      - LIVEKIT_URL=${LIVEKIT_URL}
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET}
      - YOLO_CONFIDENCE=${YOLO_CONFIDENCE:-0.5}
      - PROCESS_FPS=${PROCESS_FPS:-10}
      - USE_GPU=true
    volumes:
      - ./weights:/app/weights
      - ./data:/app/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped
    networks:
      - interview-network

  # Development: LiveKit server
  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    command: --dev --bind 0.0.0.0
    ports:
      - "7880:7880"   # HTTP
      - "7881:7881"   # RTC
      - "7882:7882"   # TCP
    networks:
      - interview-network
    profiles:
      - dev

networks:
  interview-network:
    driver: bridge
